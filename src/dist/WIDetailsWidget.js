define(["TFS/Work/RestClient","TFS/WorkItemTracking/RestClient","TFS/WorkItemTracking/Services"],function(e,t,n){return function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return e[i].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var i,s;i=[n,t,n(5),n(6),n(7),n(3),n(4)],s=function(e,t,n,i,s,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.WidgetHelpers=e,this.client=n.getClient(),this.clientwi=i.getClient()}return e.prototype.LoadWIDetails=function(e){var t=this;a.TelemetryClient.getClient(o.settings).trackPageView("Index");var n=JSON.parse(e.customSettings.data),i=$("h2");return i.text(e.name),n?($("#configwidget").hide(),$("#loadingwidget").show(),$("#content").hide(),$("#contentError").hide(),this.clientwi.getWorkItem(n.wiId).then(function(e){t.DisplayWIDetails(e),$("#loadingwidget").hide(),$("#content").show(),$("#wi-title").dotdotdot(),$("#wi-desc").dotdotdot(),$(".widget").off(),$(".widget").on("click",function(){s.WorkItemFormNavigationService.getService().then(function(e){e.openWorkItem(n.wiId,!1)})})},function(e){$("#loadingwidget").hide(),$("#contentError").attr("style","display:block;margin:10px;"),$("#contentError").addClass("error"),"404"===e.status?$("#contentError").html("TF401232: Work item Id: "+n.wiId+" does not exist, or you do not have permissions to read it."):$("#contentError").html(e.message),a.TelemetryClient.getClient(o.settings).trackException(e.message)})):(i.attr("style","color:grey"),$("#content").hide(),$("#loadingwidget").hide(),$("#contentError").hide(),$("#configwidget").show()),this.WidgetHelpers.WidgetStatusHelper.Success()},e.prototype.DisplayWIDetails=function(e){var t=e.fields["System.WorkItemType"],n=this.getWorkItemColor(t);$("#wi-header").attr("style","border-left-color: "+n+";"),$("#wi-type").html(t+" "+e.id),$("#wi-title").html(e.fields["System.Title"]);var i=e.fields["System.Description"];"Bug"===t&&(i=e.fields["Microsoft.VSTS.TCM.ReproSteps"]),"Test Case"===t&&(i=e.fields["System.Description"]),void 0!==i?(i=this.noHtml(i),$("#wi-desc").html(i)):$("#wi-desc").html(""),$("#updateby").html("Updated by ".concat(e.fields["System.ChangedBy"])),$("#updatedate").html(this.DeltaDate(new Date(e.fields["System.ChangedDate"])).text);var s=e.fields["System.AssignedTo"];void 0!==s?($("#assignuser").html(s),$("#assignavatar").attr("src",this.getMemberAvatarUrl(s))):($("#assignuser").html("Unassigned"),$("#assignavatar").hide());var a=e.fields["System.State"];$("#state").html(a);var o=this.getStateColor(a),r=o;"Removed"===a&&(r="transparent"),$("#statecircle").attr("style","border-color:"+o+";background-color:"+r)},e.prototype.noHtml=function(e){var t=e.indexOf("<"),n=e.indexOf(">"),i=e.length,s=e.substring(0,t);n===-1&&(n=t);var a=e.substring(n+1,i);return e=s+a,t!==n&&(e=this.noHtml(e)),e},e.prototype.getWorkItemColor=function(e){var t="";switch(e){case"Shared Steps":case"Shared Parameter":case"Test Case":case"Test Plan":case"Code Review Response":case"Issue":case"Feedback Request":case"Feedback Response":case"Code Review Request":case"Impediment":case"Test Suite":t="#FF9D00";break;case"Product Backlog Item":case"User Story":t="#009CCC";break;case"Task":t="#F2CB1D";break;case"Bug":t="#CC293D";break;case"Feature":t="#773B93";break;case"Epic":t="#FF7B00";break;default:t="#F2CB1D"}return t},e.prototype.getStateColor=function(e){var t="";switch(e){case"Approved":case"New":case"To Do":case"Design":t="#b2b2b2";break;case"In Progress":case"Committed":case"Open":case"Ready":case"Active":case"In Planning":t="#007acc";break;case"Done":case"Closed":case"Inactive":case"Completed":t="#393";break;case"Removed":t="#5688e0";break;default:t="#b2b2b2"}return t},e.prototype.DeltaDate=function(e){var t=Date.now(),n=e.getTime(),i=Math.floor((t-n)/864e5),s={days:i,text:""};if(i>365){var a=Math.floor(i/365);1===a?s.text="A year ago":s.text=a+" year(s) ago"}else if(i>30){var o=Math.floor(i/30);1===o?s.text="A month ago":s.text=o+" month(s) ago"}else i>7?s.text="This month":i<=7&&i>1?s.text=i+" days ago":1===i?s.text="Yesterday":s.text="Today";return s},e.prototype.getMemberAvatarUrl=function(e){var t=e.lastIndexOf("<"),n=e.lastIndexOf(">"),i=$.trim(e.substr(t+1,n-t-1));return VSS.getWebContext().host.uri+"_api/_common/IdentityImage?id=&identifier="+i},e.prototype.load=function(e){return this.LoadWIDetails(e)},e.prototype.reload=function(e){return this.LoadWIDetails(e)},e}();t.WidgetWIDetails=r,VSS.require("TFS/Dashboards/WidgetHelpers",function(e){e.IncludeWidgetStyles(),VSS.register("widetailswidget",function(){var t=new r(e);return t}),VSS.notifyLoadSucceeded()})}.apply(t,i),!(void 0!==s&&(e.exports=s))},function(e,t,n){var i,s;i=[n,t],s=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e._createLazyMethod=function(t){var n=window[e.appInsightsName];n[t]=function(){var e=arguments;n.queue?n.queue.push(function(){return n[t].apply(n,e)}):n[t].apply(n,e)}},e._defineLazyMethods=function(){var t=window[e.appInsightsName];try{t.cookie=document.cookie}catch(e){}t.queue=[];for(var n=["clearAuthenticatedUserContext","flush","setAuthenticatedUserContext","startTrackEvent","startTrackPage","stopTrackEvent","stopTrackPage","trackDependency","trackEvent","trackException","trackMetric","trackPageView","trackTrace"];n.length;)e._createLazyMethod(n.pop())},e._download=function(t){e.appInsightsInstance.config=t;var n=window[e.appInsightsName];if(n.queue||(n.queue=[]),setTimeout(function(){var e=document.createElement("script");e.src=t.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",document.head.appendChild(e)}),!t.disableExceptionTracking){var i="onerror";e._createLazyMethod("_"+i);var s=window[i];window[i]=function(e,t,a,o,r){var c=s&&s(e,t,a,o,r);return c!==!0&&n["_"+i](e,t,a,o,r),c}}},Object.defineProperty(e,"appInsightsInstance",{get:function(){if("undefined"!=typeof window)return window[e.appInsightsName]||(window[e.appInsightsName]={downloadAndSetup:e._download,_defineLazyMethods:e._defineLazyMethods},e._defineLazyMethods()),window[e.appInsightsName]},enumerable:!0,configurable:!0}),e}();n.appInsightsInitialized=!1,n.appInsightsName="appInsights",t.AppInsights=n.appInsightsInstance}.apply(t,i),!(void 0!==s&&(e.exports=s))},function(e,t){e.exports={ApplicationInsights:{InstrumentationKey:"21100e97-0b88-48ea-a1bb-efa840af423a",ExtensionContext:"WorkItemDetailsWidget",DisableTelemetry:"false",DisableAjaxTracking:"__disableAjaxTracking__",EnableDebug:"__enableDebug__"}}},function(e,t,n){var i,s;i=[n,t,n(1)],s=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.disableTelemetry="false",this.disableAjaxTracking="false",this.enableDebug="false"}return e}();t.TelemetryClientSettings=i;var s=function(){function e(){this.IsAvailable=!0}return e.getClient=function(t){return this._instance||(console.log("Creating new TelemetryClient!"),this._instance=new e,this._instance.Init(t)),this._instance},e.prototype.Init=function(e){console.log("TelemetryClient settings key: "+e.key.substring(0,8)+"************"),console.log("TelemetryClient settings extension context: "+e.extensioncontext),console.log("TelemetryClient settings disableTelemetry: "+("true"===e.disableTelemetry)),console.log("TelemetryClient settings disableAjaxTracking: "+("true"===e.disableAjaxTracking)),console.log("TelemetryClient settings enableDebug: "+("true"===e.enableDebug));var t={instrumentationKey:e.key,disableTelemetry:"true"===e.disableTelemetry,disableAjaxTracking:"true"===e.disableAjaxTracking,enableDebug:"true"===e.enableDebug};this.ExtensionContext=e.extensioncontext;try{var i=VSS.getWebContext();n.AppInsights.downloadAndSetup(t),n.AppInsights.setAuthenticatedUserContext(i.user.id,i.collection.id)}catch(e){console.log(e)}},e.prototype.trackPageView=function(e,t,i,s,a){try{n.AppInsights.trackPageView(this.ExtensionContext+"."+e,t,i,s,a),n.AppInsights.flush()}catch(e){console.log(e)}},e.prototype.trackEvent=function(e,t,i){try{console.log("Tracking event: "+this.ExtensionContext+"."+e),n.AppInsights.trackEvent(this.ExtensionContext+"."+e,t,i),n.AppInsights.flush()}catch(e){console.log(e)}},e.prototype.trackException=function(e,t,i,s){try{console.error(e);var a={name:this.ExtensionContext+"."+t,message:e};n.AppInsights.trackException(a,t,i,s),n.AppInsights.flush()}catch(e){console.log(e)}},e.prototype.trackMetric=function(e,t,i,s,a,o){try{n.AppInsights.trackMetric(this.ExtensionContext+"."+e,t,i,s,a,o),n.AppInsights.flush()}catch(e){console.log(e)}},e}();t.TelemetryClient=s}.apply(t,i),!(void 0!==s&&(e.exports=s))},function(e,t,n){var i,s;i=[n,t],s=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2);t.settings={key:i.ApplicationInsights.InstrumentationKey,extensioncontext:i.ApplicationInsights.ExtensionContext,disableTelemetry:i.ApplicationInsights.DisableTelemetry,disableAjaxTracking:i.ApplicationInsights.DisableAjaxTracking,enableDebug:i.ApplicationInsights.EnableDebug}}.apply(t,i),!(void 0!==s&&(e.exports=s))},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n}])});