define(["VSS/Authentication/Services"],function(e){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var i,o;i=[n,t,n(8),n(3),n(4)],o=function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.prototype.getDashboards=function(){var e=$.Deferred(),t=n.authTokenManager;return VSS.getAccessToken().then(function(n){var a=t.getAuthorizationHeader(n);$.ajaxSetup({headers:{Authorization:a}});var s=VSS.getWebContext().collection.uri;$.ajax({url:s+VSS.getWebContext().project.id+"/"+VSS.getWebContext().team.id+"/_apis/dashboard/dashboards",type:"GET",dataType:"json",data:"api-version=3.0-preview.2",success:function(t){e.resolve(t.dashboardEntries)},error:function(e){i.TelemetryClient.getClient(o.settings).trackException(e.response)}})}),e.promise()},e.prototype.getDashboard=function(e){var t=$.Deferred(),a=n.authTokenManager;return VSS.getAccessToken().then(function(n){var s=a.getAuthorizationHeader(n);$.ajaxSetup({headers:{Authorization:s}});var r=VSS.getWebContext().collection.uri;$.ajax({url:r+VSS.getWebContext().project.id+"/"+VSS.getWebContext().team.id+"/_apis/dashboard/dashboards/"+e,type:"GET",dataType:"json",data:"api-version=3.0-preview.2",success:function(e){t.resolve(e)},error:function(e){i.TelemetryClient.getClient(o.settings).trackException(e.response)}})}),t.promise()},e.prototype.addWidgetToDashboard=function(t,a){var s=$.Deferred(),r=n.authTokenManager;return VSS.getAccessToken().then(function(n){var c=r.getAuthorizationHeader(n);$.ajaxSetup({headers:{Authorization:c}});var d=new e;d.getDashboard(t).then(function(e){var n={name:"Work Item details",position:{row:0,column:0},size:{rowSpan:1,columnSpan:2},settings:'{"wiId":"'+a+'"}',settingsVersion:{major:1,minor:0,patch:0},dashboard:{eTag:""+e.eTag},contributionId:""+VSS.getExtensionContext().publisherId+"."+VSS.getExtensionContext().extensionId+".widetailswidget"},r=JSON.stringify(n),c=VSS.getWebContext().collection.uri;$.ajax({url:c+VSS.getWebContext().project.id+"/"+VSS.getWebContext().team.id+"/_apis/dashboard/dashboards/"+t+"/widgets?api-version=3.0-preview.2",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:r,success:function(t){console.log("WorkItemDetailWidget: WI "+a+" is added to Dashboard "+e.name),s.resolve(t)},error:function(e){i.TelemetryClient.getClient(o.settings).trackException(e.response)}})})}),s.promise()},e}();t.WiMenu=a;var s=VSS.getExtensionContext().publisherId+"."+VSS.getExtensionContext().extensionId+".addToDashboard-work-item-menu";VSS.register(s,{getMenuItems:function(e){var t=e.ids||e.workItemIds;!t&&e.id&&(t=[e.id]);var n=!1;!t&&e.workItemId&&(t=[e.workItemId],n=!0);var s=[],r=new a;return r.getDashboards().then(function(e){return e.forEach(function(e){s.push({text:e.name,title:e.name,action:function(){i.TelemetryClient.getClient(o.settings).trackPageView("ContextMenuAddToDashboard"),t.forEach(function(t,n){r.addWidgetToDashboard(e.id,t).then(function(){})})}})}),[{text:"Add to dashboard",title:"Add to dashboard",icon:"static/images/adddashboard.png",childItems:s}]})}})}.apply(t,i),!(void 0!==o&&(e.exports=o))},function(e,t,n){var i,o;i=[n,t],o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e._createLazyMethod=function(t){var n=window[e.appInsightsName];n[t]=function(){var e=arguments;n.queue?n.queue.push(function(){return n[t].apply(n,e)}):n[t].apply(n,e)}},e._defineLazyMethods=function(){var t=window[e.appInsightsName];try{t.cookie=document.cookie}catch(e){}t.queue=[];for(var n=["clearAuthenticatedUserContext","flush","setAuthenticatedUserContext","startTrackEvent","startTrackPage","stopTrackEvent","stopTrackPage","trackDependency","trackEvent","trackException","trackMetric","trackPageView","trackTrace"];n.length;)e._createLazyMethod(n.pop())},e._download=function(t){e.appInsightsInstance.config=t;var n=window[e.appInsightsName];if(n.queue||(n.queue=[]),setTimeout(function(){var e=document.createElement("script");e.src=t.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",document.head.appendChild(e)}),!t.disableExceptionTracking){var i="onerror";e._createLazyMethod("_"+i);var o=window[i];window[i]=function(e,t,a,s,r){var c=o&&o(e,t,a,s,r);return c!==!0&&n["_"+i](e,t,a,s,r),c}}},Object.defineProperty(e,"appInsightsInstance",{get:function(){if("undefined"!=typeof window)return window[e.appInsightsName]||(window[e.appInsightsName]={downloadAndSetup:e._download,_defineLazyMethods:e._defineLazyMethods},e._defineLazyMethods()),window[e.appInsightsName]},enumerable:!0,configurable:!0}),e}();n.appInsightsInitialized=!1,n.appInsightsName="appInsights",t.AppInsights=n.appInsightsInstance}.apply(t,i),!(void 0!==o&&(e.exports=o))},function(e,t){e.exports={ApplicationInsights:{InstrumentationKey:"21100e97-0b88-48ea-a1bb-efa840af423a",ExtensionContext:"WorkItemDetailsWidget",DisableTelemetry:"false",DisableAjaxTracking:"__disableAjaxTracking__",EnableDebug:"__enableDebug__"}}},function(e,t,n){var i,o;i=[n,t,n(1)],o=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.disableTelemetry="false",this.disableAjaxTracking="false",this.enableDebug="false"}return e}();t.TelemetryClientSettings=i;var o=function(){function e(){this.IsAvailable=!0}return e.getClient=function(t){return this._instance||(console.log("Creating new TelemetryClient!"),this._instance=new e,this._instance.Init(t)),this._instance},e.prototype.Init=function(e){console.log("TelemetryClient settings key: "+e.key.substring(0,8)+"************"),console.log("TelemetryClient settings extension context: "+e.extensioncontext),console.log("TelemetryClient settings disableTelemetry: "+("true"===e.disableTelemetry)),console.log("TelemetryClient settings disableAjaxTracking: "+("true"===e.disableAjaxTracking)),console.log("TelemetryClient settings enableDebug: "+("true"===e.enableDebug));var t={instrumentationKey:e.key,disableTelemetry:"true"===e.disableTelemetry,disableAjaxTracking:"true"===e.disableAjaxTracking,enableDebug:"true"===e.enableDebug};this.ExtensionContext=e.extensioncontext;try{var i=VSS.getWebContext();n.AppInsights.downloadAndSetup(t),n.AppInsights.setAuthenticatedUserContext(i.user.id,i.collection.id)}catch(e){console.log(e)}},e.prototype.trackPageView=function(e,t,i,o,a){try{n.AppInsights.trackPageView(this.ExtensionContext+"."+e,t,i,o,a),n.AppInsights.flush()}catch(e){console.log(e)}},e.prototype.trackEvent=function(e,t,i){try{console.log("Tracking event: "+this.ExtensionContext+"."+e),n.AppInsights.trackEvent(this.ExtensionContext+"."+e,t,i),n.AppInsights.flush()}catch(e){console.log(e)}},e.prototype.trackException=function(e,t,i,o){try{console.error(e);var a={name:this.ExtensionContext+"."+t,message:e};n.AppInsights.trackException(a,t,i,o),n.AppInsights.flush()}catch(e){console.log(e)}},e.prototype.trackMetric=function(e,t,i,o,a,s){try{n.AppInsights.trackMetric(this.ExtensionContext+"."+e,t,i,o,a,s),n.AppInsights.flush()}catch(e){console.log(e)}},e}();t.TelemetryClient=o}.apply(t,i),!(void 0!==o&&(e.exports=o))},function(e,t,n){var i,o;i=[n,t],o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2);t.settings={key:i.ApplicationInsights.InstrumentationKey,extensioncontext:i.ApplicationInsights.ExtensionContext,disableTelemetry:i.ApplicationInsights.DisableTelemetry,disableAjaxTracking:i.ApplicationInsights.DisableAjaxTracking,enableDebug:i.ApplicationInsights.EnableDebug}}.apply(t,i),!(void 0!==o&&(e.exports=o))},,,,function(t,n){t.exports=e}])});